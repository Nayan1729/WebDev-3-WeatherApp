<% let code = "";
 let typeOfDay = "";
if(locals.result)
{
console.log(result.list[0].weather[0].main)
switch (result.list[0].weather[0].main) {
    case 'Thunderstorm':
        code = 'thunderstorm'; // 
        break;
    case 'Drizzle':
        code = 'drizzle';//
        break;
    case 'Rain':
        code = 'rain'; //
        break;
    case 'Snow':
        code = 'snow';
        break;
    case 'Clear':
        code = 'clear'; //
        typeOfDay = result.list[0].sys.pod;
        break;
    case 'Clouds':
        code = 'clouds'; //
        break;
    case 'Mist':
        code = 'mist'; //
        break;
    case 'Smoke':
        code = 'smoke';
        break;
    case 'Haze':
        code = 'haze';
        break;
    case 'Dust':
        code = 'dust';
        break;
    case 'Fog':
        code = 'fog';
        break;
    case 'Sand':
        code = 'sand';
        break;
    case 'Ash':
        code = 'ash';
        break;
    case 'Squall':
        code = 'squall';
        break;
    case 'Tornado':
        code = 'tornado';
        break;
    default:
        code = 'bg4';
        break;
  }
}
   else {code = 'bg5';}
   
    console.log(code);
 %>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body >

  <div class="main-container">
    <%   if(!locals.result || locals.err ) { %>

    <div class="headingOfHomePage">
      <% if(locals.err) {%>
      <h2>
        Please Enter a valid City name on the searchbar
        in order to get it's weather data.
      </h2>        
        <% }else{ %>
          <h2>
            Enter your City name on the searchbar
            in order to get it's weather data.</h2>
            <% } %>
      <div class="containerForHomePage container-fluid">
        <form class="d-flex"  action="/submit" method="post" >
          <input class="form-control me-2" id="searchBox" name="city" type="search" placeholder="Enter the city" aria-label="Search">
          <button class="btn btn-outline-dark" id="btn1" type="Search">Search</button>
        </form>
      </div>
    </div>
    
    <footer>
    <h5 style="text-align: center ; color:black;">Data generated by OpenWeatherMap.org </h5>
    </footer>
    <% } else { %>
      <style>
        .main-container{
              background-image:url("/styles/<%=code%><%=typeOfDay%>.jpg");
              background-size: cover; 
              background-position: center; 
              background-repeat: no-repeat; 
              height: 100%;
              color: black;
            }@media (min-height: 650px) {
    /* Apply min-height: 100vh when viewport height is greater than 650px */
    .main-container {
        min-height: 100vh;
    }
}

      </style>
        <div class="containerForHomePage container-fluid">
          <form class="d-flex"  action="/submit" method="post" >
            <input class="form-control me-2" id="searchBox" name="city" type="search" placeholder="Enter the city" aria-label="Search">
            <button class="btn btn-outline-dark" id="btn1"  type="Search">Search</button>
          </form>
        </div>
        <div class="HeadingOfCity">
          <h1 style="text-align: center;"> Weather Today in <%= result.city.name %> </h1>
          <% var temp= Number(result.list[0].main.temp-"273.15").toFixed(0)
          var iconcode =result.list[0].weather[0].icon;%>
          <div class="city-temp">
            <!-- Temperature -->
            <h1 style="text-align: center;"> <%= temp %>&deg;C </h1>
            <div class="icon-description">

              <img id="icon" src="http://openweathermap.org/img/wn/<%= iconcode %>.png">
              
              <% const timestamp = result.list[0].dt;
              const utcDate = new Date(timestamp * 1000);
              const options = { year: 'numeric', month: 'long', day: 'numeric' };
              const formattedUTCDate = utcDate.toLocaleDateString('en-US', options); 
              %>
              <div>
                <h6 style="margin-top: 20px;"> <%= formattedUTCDate %> </h6>
                <p > <%= result.list[0].weather[0].description %> </p>
              </div>
              
            </div>  <!-- Icon description -->
        
          </div>
          <span class="today1">Min Temp | Max Temp</span>
          <% 
          // for min max temp 
          const weatherData =  result.list;
          
          let minTemp = Infinity;
          let maxTemp = -Infinity;
          
          for (let i = 0; i < 9; i++) {
            console.log(weatherData[i].main.temp - "273.15" );
            console.log(weatherData[i].dt_txt);


              const temp = weatherData[i].main.temp;
              if (temp < minTemp) minTemp = temp ;
              if (temp > maxTemp) maxTemp = temp ; 
          }
           minTemp = Number(minTemp -"273.15").toFixed(1);
           maxTemp = Number(maxTemp -"273.15").toFixed(1);
          %>
          
           <p style="text-align: center;" > <%= minTemp%>&deg;C | <%= maxTemp %>&deg;C</p>
        </div>
        <div class="center-container">
          <div class="forecast-center">
            <div class="forecast">
              <img id="icon1" src="styles/temp.png" alt="Temp icon">
              <div>
                <h5>Temp-feels</h5>
                <% var feels_like= Number(result.list[0].main.feels_like -"273.15").toFixed(1) %>
                <p style="text-align: center;"> <%= feels_like%>&deg;C </p>
              </div>
            </div>
            <!--  -->
            <div class="forecast">
              <img id="icon1" src="styles/Humidity.png" alt="Humidity icon">
              <div>
                <h5>Humidity</h5>
                <% var humidity= Number(result.list[0].main.humidity) %>
                <p style="text-align: center;"> <%= humidity%>% </p>
              </div>
            </div>

            <!--  -->

            <div class="forecast">
              <img id="icon1" src="styles/Wind.png" alt="Wind icon">
              <div>
                <h5>Wind speed</h5>
                <% var wind= Number(result.list[0].wind.speed).toFixed(2) %>
                <p style="text-align: center;"> <%= wind%> m/s </p>
              </div>
            </div>
            <!--  -->
            <div class="forecast">
              <img id="icon1" src="styles/Pressure.png" alt="Pressure icon">
              <div>
                <h5>Pressure</h5>
                <% var pressure= Number(result.list[0].main.pressure) %>
                <p style="text-align: center;"> <%= pressure %> hPa </p>
              </div>
            </div>
          </div>
        </div>
        
  <footer>
    <h5 style="text-align: center; color: black;">Data generated by OpenWeatherMap.org </h5>
    </footer>
      <% } %>
  </div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>